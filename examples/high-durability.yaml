# PromptMQ High Durability Configuration
# SQLite-like ACID guarantees for critical systems

log:
  level: "info"
  format: "json"

server:
  bind: "0.0.0.0:1883"
  ws-bind: "0.0.0.0:8080"
  read-timeout: "30s"
  write-timeout: "30s"

# MQTT Protocol Settings
mqtt:
  max-packet-size: 65535
  max-client-id-len: 65535
  max-topic-len: 65535
  max-qos: 2
  keep-alive: 60
  max-inflight: 20
  max-connections: 5000        # Lower limit due to sync overhead
  retain-available: true
  wildcard-available: true
  shared-sub-available: true

# Storage Configuration - Maximum Durability
storage:
  data-dir: "./data"
  
  # SQLite Configuration - Maximum safety and durability
  sqlite:
    cache-size: 25000          # 25k pages (~100MB cache) - conservative
    temp-store: "FILE"         # Store temp data on disk for safety
    mmap-size: 134217728       # 128MB memory-mapped I/O - conservative
    busy-timeout: 60000        # 60 second timeout - high for reliability
    synchronous: "FULL"        # Maximum durability - fsync on every write
    journal-mode: "WAL"        # WAL with full synchronization
    foreign-keys: true         # Enable all integrity constraints
    
  # Cleanup Settings - Longer retention for audit trails
  cleanup:
    max-message-age: "48h"     # 48 hour retention for audit trails
    check-interval: "2h"       # Less frequent cleanup
    batch-size: 100            # Conservative batch size

# Clustering Disabled for Maximum Durability
cluster:
  enabled: false

# Metrics & Monitoring
metrics:
  enabled: true
  bind: "0.0.0.0:9090"
  path: "/metrics"