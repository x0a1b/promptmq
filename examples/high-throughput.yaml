# PromptMQ High Throughput Configuration
# Optimized for maximum messages per second

log:
  level: "warn"                # Minimal logging overhead
  format: "json"

server:
  bind: "0.0.0.0:1883"
  ws-bind: "0.0.0.0:8080"
  read-buffer: 65536           # Larger buffers for high throughput
  write-buffer: 65536
  read-timeout: "60s"
  write-timeout: "60s"

# MQTT Protocol Settings - Optimized for throughput
mqtt:
  max-packet-size: 65535
  max-client-id-len: 256       # Shorter IDs for efficiency
  max-topic-len: 512           # Shorter topics for efficiency
  max-qos: 1                   # QoS 1 for balance of speed and reliability
  keep-alive: 120              # Longer keep-alive to reduce overhead
  max-inflight: 50             # Higher in-flight for better throughput
  max-connections: 50000       # Very high connection limit
  retain-available: false      # Disable retain for better performance
  wildcard-available: true
  shared-sub-available: true

# Storage Configuration - Maximum Performance
storage:
  data-dir: "./data"
  
  # SQLite Configuration - Maximum performance settings
  sqlite:
    cache-size: -204800        # 200MB cache (negative = KB)
    temp-store: "MEMORY"       # All temp data in memory
    mmap-size: 1073741824      # 1GB memory-mapped I/O
    busy-timeout: 5000         # Short timeout for fast failures
    synchronous: "OFF"         # Maximum performance (less safe)
    journal-mode: "MEMORY"     # Keep journal in memory
    foreign-keys: false        # Disable for slight performance gain
    
  # Cleanup Settings - Aggressive for performance
  cleanup:
    max-message-age: "2h"      # Short retention for performance
    check-interval: "30m"      # Frequent cleanup
    batch-size: 2000           # Large batches for efficiency

# Clustering for horizontal scaling
cluster:
  enabled: false               # Enable for multi-node scaling
  bind: "0.0.0.0:7946"
  peers: []

# Metrics with minimal overhead
metrics:
  enabled: true
  bind: "0.0.0.0:9090"
  path: "/metrics"